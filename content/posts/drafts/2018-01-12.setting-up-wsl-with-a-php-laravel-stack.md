---
title: Setting Up WSL with a PHP/Laravel Stack
---

Recently, I've been toying around with the use of WSL for development on my PC. I've used a Mac to code for the last 6 or so years, but having a powerful gaming PC I felt like it was time to see if I could get the best of both worlds out of it. The more I've been using Windows 10, the more I've come to enjoy the experience.

For work I typically create Laravel applications, along with the occasional WordPress site, so I needed WSL to be capable of my default setup - which is the following:

- Nginx
- PHP 
- MySql
- Dnsmasq
- Valet

After a bit of testing and reconigurations, I've got a setup which seems to be working well for what I need it to and found it relatively simple and easy.

Below, I'll go over (in as few steps as possible) how to set up WSL and Install the above tools.

## Install WSL

1. First things first, you're going to need to enable the windows subsytem, to do this use "Turn Windows features on or off" and select "Windows Subsystem for Linux" to enable it, click OK, reboot, and use this app.
2. Once rebooted, you're going to need to install a subsystem, you can now find these in the Windows Store. Go a head and [download Ubuntu](https://www.microsoft.com/en-gb/store/p/ubuntu/9nblggh4msv6). 
3. When the WSL is instlaled, you're going to need to configure it a little, open up command prompt (or any other terminal emulator you have - such as Hyper/CMDer) and enter `ubuntu`. This will run the setup process and ask you to set a username and password.

WSL is now installed, setup, and ready for us to utilise. 

## Setting up our requirements

1. As of writing this, PHP 7.1 is the latest stable release. To access and install it, we'll need to add the personal package archive for PHP. To do this run:  

   ```bash
   sudo add-apt-repository ppa:ondrej/php
   ```

2. Now we have the package archive added, update and upgrade Ubuntu to download the latest packages.  

   ```bash
   sudo apt-get update && sudo apt-get upgrade
   ```

3. Before we can install, and utilise, valet we'll need to install some required packages. Run the following in your terminal and go grab a drink (this will take a while).  

   ```bash
   sudo apt-get install php-fpm php-mysql php7.1-cli php7.1-curl php7.1-mbstring php7.1-mcrypt php7.1-xml php7.1-zip php7.1-intl curl git unzip php-cli
   ```

4. Download the Composer installer.   

   ```bash
   cd ~
   curl -sS https://getcomposer.org/installer -o composer-setup.php
   ```

5. Install Composer

   ```bash
   sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer
   ```

6. At the current time of writing, the only way to get Valet to work is to use a fork of the linux valet repository by  [valeryan](https://github.com/valeryan/valet-wsl). To install this, we'll need to modify the global composer file located at`~/.composer/composer.json` . Add the following code:

   ```json
   {
       "require": {
           "valeryan/valet-wsl": "dev-master"
       },
       "repositories": [
           {
               "type": "vcs",
               "url":  "git@github.com:valeryan/valet-wsl.git"
           }
       ]
   }
   ```

7. To install, run `composer global update`. 
   â€‹
   _You may encounter a permissions error, if you do, the ownership of the `.composer/` directory needs changing, to do this we can run `sudo chown -R $USER .composer/`_.

8. Next, run valets install comand to set everything up for us. `valet install`. Note: do not run `valet park` or `valet link` just yet.

9. If you browse to `http://localhost` through a Windows browser you should be presented with a 502 error bad gateway, this means everything is set up correctly so far! 

## Creating our Sites Directory

WSL automatically mounts your window drives so they are accessible via the command line. All directories will be mounted at  `/mnt/`. To set up Valet to park/link one of our folders, we'll need to do the following.

1. Set up a folder on your Windows drive where you want to store the files, for me this was `u/sites`.

2. Within WSL, create a symbolink for your destination drive to your home folder with the following 

   ````
   cd ~
   ln -s /mnt/u/sites
   ````

3. Park valet in the directory so that all subdirectories are automatically read.

   ```
   cd sites
   valet park
   ```

4. Create a subdirectory, e.g. `mysite`,  and add a test file which presents some readable content to the browser, such as `<?php phpinfo();`

**Note:** If you try and access the in the browser at the minute this will not load, this is because we'll need to add it to our host file or setup wildcard domains on Windows, see the below steps.

## Wildcard Domains on Windows

Windows, by default, does not allow us to read wildcards when modifiyng our hosts file. Now, you could manually add each site that you create in valet to your hosts file and be fine, but this adds an extra manual step. We're going to automate this with a tool called [Acrylic DNS Proxy](http://mayakron.altervista.org/wikibase/show.php?id=AcrylicHome).

Acrylic DNS Proxy is a tool which allows us to add an extra layer on our computer to catch and cache domains, it can be used for all sorts of purposes, but for our intent we want to set it up to read wildcard domains. 

Download and install the software, then ensure the service is running. This will create a service in Windows which can be disabled or enabled at will.

Acrylic uses a standalone hosts file on top of Windows, and we'll need to modify this with our wildcard parameters. In the start menu, find the Acrylic folder and open the hosts file. This will load a .txt file with comments providing examples of what you can do, for our purpose modify it with the following line at the bottom.

```
127.0.0.1 *.test
```

Save and then restart Acrylic. All `.test` domains should now be served to your local (WSL) stack.

**Side Note**: You may get a 404 when you try and load the URLs in the browser, and I found that this was because my computer was not reading the host file properly. To get it to read the Acrylic host, I needed to modify my adapter settings so that the dns server was set to  `127.0.0.1` for ipv4 and  `::1` for ipv6. You can [read more about this here](http://mayakron.altervista.org/wikibase/show.php?id=AcrylicWindows10Configuration).



Everything should now be set up and working.

Happy Coding ! 